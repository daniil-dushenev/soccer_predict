#  Предсказываем результаты футбольных матчей Российской Премьер-лиги

Начнем с того, что предсказывать футбольные матчи никак не возможно. На результат игры влияет множество факторов, ход матча может измениться в любой момент. 
Но тем не менее, при помощи машинного обучения можно попробовать что-то поугадывать.

## 1. Данные
Информацию о матчах я любезно взял с сайта [fbref.com](https://fbref.com/). В таблицу я поместил данные о каждой игре с сезона 18-19 (за 5 прошлых сезонов)
<br>Основные векторы признаков:
* Wk - номер игрового тура (1-30 в сезоне)
* Home/Away - играющие команды в матче, одна играет дома, другая в гостях
* Referee - имя судьи, который судит матч
* Total_last_year_Home/Away - место в таблице по окончании предыдущего сезона
* target - целевая функция (0 - победа Home, 1 - ничья, 2 - победа Away)
![image](https://github.com/daniil-dushenev/soccer_predict/assets/44606552/7d0fbfe5-5749-4c16-a2c6-8edef176f964)
Из данных я поубирал игры с командами, которые в прошлом сезоне играли в лигах ниже,
о них мало данных. Всего у меня получилось 853 наблюдения. Также замечу, что при разметке данных на тренировочные и тестовые,
я отключил перемешивание данных, что улучшило качество модели. Мои данные отсортированы от старых к новым.

## 2. Постановка задачи и обучение модели (классификатор)
Я буду предсказывать результат игры. Метрикой качества я выбрал accuracy. 
Будем обучать модель при помощи CatBoost (потому что лучше работает с категориальными признаками
 и вообще мне просто захотелось поработать с этим алгоритмом). Обучаем модель сначала на 
 кросс-валидации и смотрим результаты. <br>
 ![image](https://github.com/daniil-dushenev/soccer_predict/assets/44606552/2512425c-d428-4767-b2cb-6b0d76556bac)
<br>
![image](https://github.com/daniil-dushenev/soccer_predict/assets/44606552/952ec834-7418-4c0e-93cf-e75f32dde132)
<br>
Метрики конечно ужас:see_no_evil:( Ну а чего я ожидал?)
Теперь обучаем нашу итоговую модель и смотрим точность на тестовой выборке: <br>
![image](https://github.com/daniil-dushenev/soccer_predict/assets/44606552/7f586f18-9c95-47f7-85b8-61a0545caed3)

## 3. Тестируем

Теперь самое интересное, смотрим прогнозы последних матчей. В расчет я взял
матчи с 1 по 4 тур сезона 2023-2024. <br>
![image](https://github.com/daniil-dushenev/soccer_predict/assets/44606552/f338c701-184e-49a3-bdc2-b9969a47a143)
<br>
Записи идут формата: <br>[Команда1 - Команда2] [П1/П2/Н] [Реальный счет] [Вероятность П1, Н, П2]
<br>
П1/П2/Н - победа 1 команды, победа 2 команды, ничья<br>
В целом, неплохо отрабатывает, пробежимся по результатам:
* (+-) Динамо 1-3 Краснодар:(П1) модель неуверена в ответе, действительно можно сказать равные команды
* (+-) Урал 2-1 ЦСКА:(П2) модель предсказала так же, как это бы и сделал я) Матч прошел непредсказуемо
* (+) НН 0-2 Зенит:(П2) уверенно предсказала победу Зенита
* (-) Ахмат 1-2 Крылья Советов:(П1) сильно ошиблась
* (+) Спартак 3-2 Оренбург:(П1) уверенно предсказала победу Спартака
* (+) Ростов 2-1 Факел:(П1) очень уверенно предсказала победу Ростова
* (+-) Крылья Советов 3-3 Динамо:(П2) ошиблась, хотя матч вышел непредсказуемым
* (-) Урал 0-0 НН:(П1) ошиблась
* (-) Ростов 1-1 Зенит:(П2) ошиблась, хоть и не сильно.
* (+) Факел 1-4 Локомотив:(П2) уверенно предсказала
* (+) Ахмат 2-3 ЦСКА:(П2) Угадала, хоть и очень не уверена. Матч тоже неодназначный
* (+) Краснодар 2-0 Сочи:(П1) уверенно предсказала
* (+) Краснодар 1-0 НН:(П1) уверенно предсказала
* (+-) Крылья Советов 5-1 Ростов:(П2) мне тоже непонятно что произошло с Ростовом
* (+) Оренбург 0-2 Урал:(П2) уверенно предсказала
* (+) ЦСКА 4-1 Локомотив:(П1) уверенно предсказала
<br>
(+) - модель правильно ответила<br>
(+-) - модель ответила неверно, но в целом логично<br>
(-) - ошиблась<br>

## 4. Пробуем регрессию
Я подумал изменить модель. Я поменял целевую функцию, теперь 0 означает победу 1 команды, 0.5 - ничью, 1 - победа 2 команды.
Теперь будем использовать модель регрессии: <br>
![image](https://github.com/daniil-dushenev/soccer_predict/assets/44606552/3c22ffb0-0799-4617-9293-0f61c7c576ae)
<br>Ошибка до сих пор довольно большая. Давайте попробуем протестировать. <br>
![image](https://github.com/daniil-dushenev/soccer_predict/assets/44606552/33aba07e-6863-4c01-b073-facd05b71336)
<br>Я поставил, что вероятность от 0 до 0.4 - П1, от 0.4 до 0.6 - Н, от 0.6 до 1 - П2. В целом, результаты плюс минус такие же,
модель в целом ведет себя адекватно. Возможно так мы сможем лучше анализировать как закончится игра.

## 5. Итоги

Можно сказать, что модель предсказывает довольно логично, если смотреть на 
прогнозируемые вероятности. В большинстве случаев она отработала так же, как бы и я 
делал прогнозы. Некоторые матчи оказались просто непредсказуемые ввиду различных обстоятельств.
В целом, я доволен моделью) <br>Давайте взглянем на важные, по мнению модели, признаки:<br>
![загруженное (3)](https://github.com/daniil-dushenev/soccer_predict/assets/44606552/3bd64fe8-8bc6-45cd-b221-09279f07f799)
<br>Заметим, что судьи никак не влияют на результат игры) Иногда в это трудно поверить

## 6. Бонус*

Взглянем на то, при каких судьях Зенит больше выигрывает. <br>
![загруженное (2)](https://github.com/daniil-dushenev/soccer_predict/assets/44606552/1c1e2d67-b69a-4afc-9ea1-a09a15de1153)
<br>
Странно, что с Мешковым Зенит выиграл все матчи (или не странно). В общем, тут
уже судите сами)
